# æœ¬åœ°é–‹ç™¼æŒ‡å—

## äº’å‹•å¼å†’éšªæ•…äº‹å¼•æ“æœ¬åœ°é–‹ç™¼ç’°å¢ƒè¨­å®š

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°‡å”åŠ©æ‚¨åœ¨æœ¬åœ°ç’°å¢ƒä¸­è¨­å®šå’Œé–‹ç™¼äº’å‹•å¼å†’éšªæ•…äº‹å¼•æ“ã€‚æˆ‘å€‘çš„ç³»çµ±æ¡ç”¨ç¾ä»£åŒ–çš„å¤šè¡¨è³‡æ–™åº«æ¶æ§‹ï¼Œæ”¯æ´ PostgreSQL å’Œ SQLite å…©ç¨®è³‡æ–™åº«é¸é …ï¼Œè®“æ‚¨å¯ä»¥æ ¹æ“šé–‹ç™¼éœ€æ±‚é¸æ“‡æœ€é©åˆçš„é…ç½®ã€‚

### é–‹ç™¼ç’°å¢ƒç‰¹è‰²

æˆ‘å€‘çš„æœ¬åœ°é–‹ç™¼ç’°å¢ƒè¨­è¨ˆè€ƒæ…®äº†é–‹ç™¼è€…çš„å„ç¨®éœ€æ±‚å’Œé™åˆ¶ã€‚ç³»çµ±æ”¯æ´å¤šç¨®ä½œæ¥­ç³»çµ±ï¼ŒåŒ…æ‹¬ Windowsã€macOS å’Œ Linuxï¼Œä¸¦ä¸”æä¾›äº†éˆæ´»çš„è³‡æ–™åº«é¸é …ã€‚å°æ–¼å¿«é€ŸåŸå‹é–‹ç™¼å’Œæ¸¬è©¦ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ SQLite è³‡æ–™åº«ï¼Œç„¡éœ€å®‰è£é¡å¤–çš„è³‡æ–™åº«æœå‹™ã€‚å°æ–¼æ›´æ¥è¿‘ç”Ÿç”¢ç’°å¢ƒçš„é–‹ç™¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ PostgreSQL è³‡æ–™åº«ã€‚

é–‹ç™¼ç’°å¢ƒåŒ…å«äº†å®Œæ•´çš„æ•…äº‹ç®¡ç†å·¥å…·ï¼Œè®“æ‚¨å¯ä»¥è¼•é¬†åœ°å»ºç«‹ã€ç·¨è¼¯ã€é©—è­‰å’Œè½‰æ›æ•…äº‹å…§å®¹ã€‚æˆ‘å€‘ä¹Ÿæä¾›äº†è©³ç´°çš„é™¤éŒ¯å·¥å…·å’Œæ¸¬è©¦è…³æœ¬ï¼Œå¹«åŠ©æ‚¨å¿«é€Ÿå®šä½å’Œè§£æ±ºå•é¡Œã€‚

### ç³»çµ±éœ€æ±‚

åœ¨é–‹å§‹è¨­å®šä¹‹å‰ï¼Œè«‹ç¢ºä¿æ‚¨çš„ç³»çµ±æ»¿è¶³ä»¥ä¸‹åŸºæœ¬éœ€æ±‚ã€‚æ‚¨éœ€è¦ Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå»ºè­°ä½¿ç”¨ Python 3.11 ä»¥ç²å¾—æœ€ä½³æ•ˆèƒ½å’Œç›¸å®¹æ€§ã€‚æ‚¨ä¹Ÿéœ€è¦ Git ä¾†ç®¡ç†ç¨‹å¼ç¢¼ç‰ˆæœ¬ï¼Œä»¥åŠä¸€å€‹é©åˆçš„ç¨‹å¼ç¢¼ç·¨è¼¯å™¨ï¼Œå¦‚ Visual Studio Codeã€PyCharm æˆ– Sublime Textã€‚

å°æ–¼è³‡æ–™åº«æ–¹é¢ï¼Œå¦‚æœæ‚¨é¸æ“‡ä½¿ç”¨ PostgreSQLï¼Œéœ€è¦å®‰è£ PostgreSQL 12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨é¸æ“‡ä½¿ç”¨ SQLiteï¼Œå‰‡ç„¡éœ€é¡å¤–å®‰è£ï¼Œå› ç‚º SQLite å·²ç¶“åŒ…å«åœ¨ Python æ¨™æº–åº«ä¸­ã€‚

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒæº–å‚™

é¦–å…ˆï¼Œç¢ºä¿æ‚¨çš„ç³»çµ±å·²ç¶“å®‰è£äº† Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥é€éä»¥ä¸‹å‘½ä»¤ä¾†æª¢æŸ¥ Python ç‰ˆæœ¬ï¼š

```bash
python --version
# æˆ–
python3 --version
```

å¦‚æœæ‚¨çš„ç³»çµ±æ²’æœ‰å®‰è£ Pythonï¼Œè«‹å‰å¾€ [python.org](https://www.python.org/) ä¸‹è¼‰ä¸¦å®‰è£æœ€æ–°ç‰ˆæœ¬ã€‚åœ¨ Windows ç³»çµ±ä¸Šï¼Œå»ºè­°åœ¨å®‰è£æ™‚å‹¾é¸ "Add Python to PATH" é¸é …ã€‚

æ¥ä¸‹ä¾†ï¼Œå»ºè­°å»ºç«‹ä¸€å€‹è™›æ“¬ç’°å¢ƒä¾†éš”é›¢å°ˆæ¡ˆä¾è³´ã€‚è™›æ“¬ç’°å¢ƒå¯ä»¥é¿å…ä¸åŒå°ˆæ¡ˆä¹‹é–“çš„å¥—ä»¶è¡çªï¼Œæ˜¯ Python é–‹ç™¼çš„æœ€ä½³å¯¦è¸ï¼š

```bash
# å»ºç«‹è™›æ“¬ç’°å¢ƒ
python -m venv story-engine-env

# å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
# Windows
story-engine-env\Scripts\activate

# macOS/Linux
source story-engine-env/bin/activate
```

å•Ÿå‹•è™›æ“¬ç’°å¢ƒå¾Œï¼Œæ‚¨çš„å‘½ä»¤æç¤ºå­—å…ƒæ‡‰è©²æœƒé¡¯ç¤ºç’°å¢ƒåç¨±ï¼Œè¡¨ç¤ºè™›æ“¬ç’°å¢ƒå·²ç¶“å•Ÿå‹•ã€‚

### å–å¾—å°ˆæ¡ˆç¨‹å¼ç¢¼

å¦‚æœæ‚¨æ˜¯å¾ GitHub å–å¾—å°ˆæ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¾†è¤‡è£½ repositoryï¼š

```bash
git clone https://github.com/your-username/story-engine-api.git
cd story-engine-api
```

å¦‚æœæ‚¨æ˜¯å¾å£“ç¸®æª”æ¡ˆå–å¾—å°ˆæ¡ˆï¼Œè«‹è§£å£“ç¸®åˆ°é©ç•¶çš„ç›®éŒ„ä¸¦é€²å…¥è©²ç›®éŒ„ã€‚

### å®‰è£ä¾è³´å¥—ä»¶

é€²å…¥å°ˆæ¡ˆç›®éŒ„å¾Œï¼Œé¦–å…ˆå®‰è£åŸºæœ¬çš„ Python ä¾è³´å¥—ä»¶ï¼š

```bash
pip install -r requirements.txt
```

å¦‚æœæ‚¨åœ¨å®‰è£éç¨‹ä¸­é‡åˆ°å•é¡Œï¼Œç‰¹åˆ¥æ˜¯èˆ‡ `psycopg2-binary` ç›¸é—œçš„ç·¨è­¯éŒ¯èª¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¾†é¿å…ç·¨è­¯å•é¡Œï¼š

```bash
pip install --only-binary=:all: psycopg2-binary==2.9.10
```

é€™å€‹å‘½ä»¤æœƒå¼·åˆ¶ä½¿ç”¨é ç·¨è­¯çš„äºŒé€²ä½å¥—ä»¶ï¼Œé¿å…åœ¨æœ¬åœ°ç·¨è­¯æ™‚å¯èƒ½é‡åˆ°çš„å•é¡Œã€‚

### è³‡æ–™åº«è¨­å®šé¸æ“‡

æˆ‘å€‘çš„ç³»çµ±æ”¯æ´å…©ç¨®è³‡æ–™åº«é…ç½®ï¼šSQLiteï¼ˆé©åˆé–‹ç™¼å’Œæ¸¬è©¦ï¼‰å’Œ PostgreSQLï¼ˆé©åˆç”Ÿç”¢ç’°å¢ƒæ¨¡æ“¬ï¼‰ã€‚

**é¸é …ä¸€ï¼šä½¿ç”¨ SQLiteï¼ˆæ¨è–¦ç”¨æ–¼é–‹ç™¼ï¼‰**

SQLite æ˜¯æœ€ç°¡å–®çš„é¸æ“‡ï¼Œç„¡éœ€å®‰è£é¡å¤–çš„è³‡æ–™åº«æœå‹™ã€‚å»ºç«‹ `.env` æª”æ¡ˆä¸¦è¨­å®šä»¥ä¸‹å…§å®¹ï¼š

```bash
# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
cp .env.example .env

# ç·¨è¼¯ .env æª”æ¡ˆï¼Œè¨­å®š SQLite è³‡æ–™åº«
echo "DATABASE_URL=sqlite:///./story_engine.db" > .env
```

**é¸é …äºŒï¼šä½¿ç”¨ PostgreSQLï¼ˆæ¨è–¦ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒæ¨¡æ“¬ï¼‰**

å¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨èˆ‡ç”Ÿç”¢ç’°å¢ƒç›¸åŒçš„ PostgreSQL è³‡æ–™åº«ï¼Œé¦–å…ˆéœ€è¦å®‰è£ PostgreSQLã€‚

åœ¨ Windows ä¸Šï¼Œæ‚¨å¯ä»¥å¾ [postgresql.org](https://www.postgresql.org/download/windows/) ä¸‹è¼‰å®‰è£ç¨‹å¼ã€‚åœ¨ macOS ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ Homebrewï¼š

```bash
brew install postgresql
brew services start postgresql
```

åœ¨ Ubuntu/Debian ä¸Šï¼š

```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

å®‰è£å®Œæˆå¾Œï¼Œå»ºç«‹è³‡æ–™åº«å’Œä½¿ç”¨è€…ï¼š

```bash
# åˆ‡æ›åˆ° postgres ä½¿ç”¨è€…
sudo -u postgres psql

# åœ¨ PostgreSQL å‘½ä»¤åˆ—ä¸­åŸ·è¡Œ
CREATE DATABASE story_engine;
CREATE USER story_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE story_engine TO story_user;
\q
```

ç„¶å¾Œåœ¨ `.env` æª”æ¡ˆä¸­è¨­å®š PostgreSQL é€£ç·šï¼š

```
DATABASE_URL=postgresql://story_user:your_password@localhost:5432/story_engine
```

---

## ğŸ”§ é–‹ç™¼ç’°å¢ƒè¨­å®š

### åˆå§‹åŒ–è³‡æ–™åº«

å®Œæˆè³‡æ–™åº«è¨­å®šå¾Œï¼Œéœ€è¦åˆå§‹åŒ–è³‡æ–™åº«çµæ§‹ã€‚æˆ‘å€‘çš„ç³»çµ±æœƒè‡ªå‹•å»ºç«‹å¿…è¦çš„è³‡æ–™è¡¨ï¼š

```bash
# æ¸¬è©¦è³‡æ–™åº«é€£ç·š
python test_db_connection.py

# åˆå§‹åŒ–è³‡æ–™åº«ä¸¦è¼‰å…¥é è¨­æ•…äº‹
python seed_data.py
```

å¦‚æœæ‚¨çœ‹åˆ°æˆåŠŸè¨Šæ¯ï¼Œè¡¨ç¤ºè³‡æ–™åº«å·²ç¶“æ­£ç¢ºè¨­å®šä¸¦è¼‰å…¥äº†é è¨­çš„æ£®æ—å†’éšªæ•…äº‹ã€‚

### å•Ÿå‹•é–‹ç™¼æœå‹™å™¨

ç¾åœ¨æ‚¨å¯ä»¥å•Ÿå‹• FastAPI é–‹ç™¼æœå‹™å™¨ï¼š

```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

`--reload` åƒæ•¸æœƒè®“æœå‹™å™¨åœ¨ç¨‹å¼ç¢¼è®Šæ›´æ™‚è‡ªå‹•é‡æ–°è¼‰å…¥ï¼Œé€™å°é–‹ç™¼éå¸¸æœ‰ç”¨ã€‚`--host 0.0.0.0` è®“æœå‹™å™¨æ¥å—ä¾†è‡ªä»»ä½• IP çš„é€£ç·šï¼Œ`--port 8000` æŒ‡å®šæœå‹™å™¨ç«¯å£ã€‚

æœå‹™å™¨å•Ÿå‹•å¾Œï¼Œæ‚¨å¯ä»¥åœ¨ç€è¦½å™¨ä¸­è¨ªå•ä»¥ä¸‹ URLï¼š

- API æ–‡ä»¶ï¼šhttp://localhost:8000/docs
- ReDoc æ–‡ä»¶ï¼šhttp://localhost:8000/redoc
- OpenAPI Schemaï¼šhttp://localhost:8000/openapi.json

### é©—è­‰å®‰è£

ç‚ºäº†ç¢ºä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸é‹ä½œï¼ŒåŸ·è¡Œæˆ‘å€‘æä¾›çš„æ¸¬è©¦è…³æœ¬ï¼š

```bash
# åŸ·è¡Œ API åŠŸèƒ½æ¸¬è©¦
python test_api.py
```

é€™å€‹è…³æœ¬æœƒæ¸¬è©¦æ‰€æœ‰ä¸»è¦çš„ API ç«¯é»ï¼ŒåŒ…æ‹¬æ•…äº‹åˆ—è¡¨ã€ç« ç¯€è¼‰å…¥ã€æ“²éª°åŠŸèƒ½ç­‰ã€‚å¦‚æœæ‰€æœ‰æ¸¬è©¦éƒ½é€šéï¼Œè¡¨ç¤ºæ‚¨çš„é–‹ç™¼ç’°å¢ƒå·²ç¶“æ­£ç¢ºè¨­å®šã€‚

---

## ğŸ› ï¸ é–‹ç™¼å·¥å…·å’Œå·¥ä½œæµç¨‹

### ç¨‹å¼ç¢¼ç·¨è¼¯å™¨è¨­å®š

**Visual Studio Code è¨­å®š**

å¦‚æœæ‚¨ä½¿ç”¨ Visual Studio Codeï¼Œå»ºè­°å®‰è£ä»¥ä¸‹æ“´å……å¥—ä»¶ä¾†æå‡é–‹ç™¼é«”é©—ï¼š

- Pythonï¼šæä¾› Python èªæ³•é«˜äº®å’Œé™¤éŒ¯åŠŸèƒ½
- Pylanceï¼šæä¾›é€²éšçš„ Python èªè¨€æ”¯æ´
- SQLite Viewerï¼šç”¨æ–¼æŸ¥çœ‹å’Œç·¨è¼¯ SQLite è³‡æ–™åº«
- REST Clientï¼šç”¨æ–¼æ¸¬è©¦ API ç«¯é»

æ‚¨å¯ä»¥åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `.vscode/settings.json` æª”æ¡ˆä¾†è¨­å®šå°ˆæ¡ˆç‰¹å®šçš„è¨­å®šï¼š

```json
{
  "python.defaultInterpreterPath": "./story-engine-env/bin/python",
  "python.linting.enabled": true,
  "python.linting.pylintEnabled": true,
  "python.formatting.provider": "black",
  "files.exclude": {
    "**/__pycache__": true,
    "**/*.pyc": true
  }
}
```

**PyCharm è¨­å®š**

å¦‚æœæ‚¨ä½¿ç”¨ PyCharmï¼Œå»ºè­°é€²è¡Œä»¥ä¸‹è¨­å®šï¼š

1. è¨­å®š Python è§£é‡‹å™¨ç‚ºè™›æ“¬ç’°å¢ƒä¸­çš„ Python
2. å•Ÿç”¨ç¨‹å¼ç¢¼æ ¼å¼åŒ–å·¥å…·ï¼ˆå¦‚ Blackï¼‰
3. è¨­å®šè³‡æ–™åº«é€£ç·šä»¥ä¾¿ç›´æ¥åœ¨ IDE ä¸­æŸ¥çœ‹è³‡æ–™
4. å•Ÿç”¨ FastAPI æ”¯æ´ä»¥ç²å¾—æ›´å¥½çš„ç¨‹å¼ç¢¼æç¤º

### ç¨‹å¼ç¢¼å“è³ªå·¥å…·

ç‚ºäº†ç¶­è­·ç¨‹å¼ç¢¼å“è³ªï¼Œå»ºè­°ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

**ç¨‹å¼ç¢¼æ ¼å¼åŒ–**ï¼š

```bash
# å®‰è£ Black ç¨‹å¼ç¢¼æ ¼å¼åŒ–å·¥å…·
pip install black

# æ ¼å¼åŒ–æ‰€æœ‰ Python æª”æ¡ˆ
black .
```

**ç¨‹å¼ç¢¼æª¢æŸ¥**ï¼š

```bash
# å®‰è£ Flake8 ç¨‹å¼ç¢¼æª¢æŸ¥å·¥å…·
pip install flake8

# æª¢æŸ¥ç¨‹å¼ç¢¼å“è³ª
flake8 .
```

**å‹åˆ¥æª¢æŸ¥**ï¼š

```bash
# å®‰è£ mypy å‹åˆ¥æª¢æŸ¥å·¥å…·
pip install mypy

# åŸ·è¡Œå‹åˆ¥æª¢æŸ¥
mypy .
```

### Git å·¥ä½œæµç¨‹

å»ºè­°ä½¿ç”¨ä»¥ä¸‹ Git å·¥ä½œæµç¨‹ä¾†ç®¡ç†ç¨‹å¼ç¢¼ç‰ˆæœ¬ï¼š

**åˆå§‹è¨­å®š**ï¼š

```bash
# è¨­å®š Git ä½¿ç”¨è€…è³‡è¨Š
git config user.name "Your Name"
git config user.email "your.email@example.com"

# å»ºç«‹ .gitignore æª”æ¡ˆï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
echo "__pycache__/" >> .gitignore
echo "*.pyc" >> .gitignore
echo ".env" >> .gitignore
echo "story_engine.db" >> .gitignore
```

**æ—¥å¸¸é–‹ç™¼æµç¨‹**ï¼š

```bash
# å»ºç«‹æ–°çš„åŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-story-feature

# é€²è¡Œé–‹ç™¼å·¥ä½œ
# ... ç·¨è¼¯æª”æ¡ˆ ...

# æäº¤è®Šæ›´
git add .
git commit -m "Add new story feature"

# æ¨é€åˆ°é ç«¯ repository
git push origin feature/new-story-feature
```

---

## ğŸ“Š è³‡æ–™åº«ç®¡ç†

### å¤šè¡¨æ¶æ§‹ç†è§£

æˆ‘å€‘çš„ç³»çµ±æ¡ç”¨å‰µæ–°çš„å¤šè¡¨è¨­è¨ˆï¼Œæ¯å€‹æ•…äº‹éƒ½æœ‰ç¨ç«‹çš„è³‡æ–™è¡¨ã€‚é€™ç¨®è¨­è¨ˆæä¾›äº†ä»¥ä¸‹å„ªå‹¢ï¼š

**è³‡æ–™éš”é›¢**ï¼šæ¯å€‹æ•…äº‹çš„è³‡æ–™å®Œå…¨ç¨ç«‹ï¼Œä¸æœƒäº’ç›¸å½±éŸ¿ã€‚é€™è®“æ•…äº‹çš„å‚™ä»½ã€é‚„åŸå’Œç¶­è­·è®Šå¾—æ›´åŠ ç°¡å–®ã€‚

**æ•ˆèƒ½å„ªåŒ–**ï¼šç•¶æ•…äº‹æ•¸é‡å¢åŠ æ™‚ï¼ŒæŸ¥è©¢æ•ˆèƒ½ä¸æœƒå› ç‚ºå–®ä¸€å¤§è¡¨è€Œä¸‹é™ã€‚æ¯å€‹æ•…äº‹è¡¨çš„å¤§å°ç›¸å°è¼ƒå°ï¼ŒæŸ¥è©¢é€Ÿåº¦æ›´å¿«ã€‚

**éˆæ´»æ€§**ï¼šå¯ä»¥ç‚ºä¸åŒçš„æ•…äº‹è¨­å®šä¸åŒçš„ç´¢å¼•å’Œå„ªåŒ–ç­–ç•¥ã€‚ä¹Ÿå¯ä»¥è¼•é¬†åœ°å°‡ç‰¹å®šæ•…äº‹é·ç§»åˆ°ä¸åŒçš„è³‡æ–™åº«å¯¦ä¾‹ã€‚

### è³‡æ–™åº«çµæ§‹

**æ•…äº‹è¨»å†Šè¡¨ï¼ˆstory_registryï¼‰**ï¼š
é€™æ˜¯ç³»çµ±çš„æ ¸å¿ƒè¡¨ï¼Œè¨˜éŒ„æ‰€æœ‰å·²è¨»å†Šçš„æ•…äº‹è³‡è¨Šï¼š

```sql
CREATE TABLE story_registry (
    story_id VARCHAR(50) PRIMARY KEY,
    table_name VARCHAR(100) NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    author VARCHAR(255),
    version VARCHAR(50) DEFAULT '1.0',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**æ•…äº‹è³‡æ–™è¡¨ï¼ˆå‹•æ…‹å»ºç«‹ï¼‰**ï¼š
æ¯å€‹æ•…äº‹éƒ½æœ‰ç¨ç«‹çš„è³‡æ–™è¡¨ï¼Œä¾‹å¦‚ `story_forest_adventure`ï¼š

```sql
CREATE TABLE story_forest_adventure (
    id INTEGER PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    options JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### è³‡æ–™åº«æ“ä½œå·¥å…·

**æŸ¥çœ‹æ‰€æœ‰æ•…äº‹**ï¼š

```bash
# åˆ—å‡ºæ‰€æœ‰å·²è¨»å†Šçš„æ•…äº‹
python seed_data.py --list-stories

# æŸ¥çœ‹ç‰¹å®šæ•…äº‹çš„ç« ç¯€
python seed_data.py --list-chapters forest_adventure
```

**åŒ¯å‡ºå’ŒåŒ¯å…¥**ï¼š

```bash
# åŒ¯å‡ºç‰¹å®šæ•…äº‹
python seed_data.py --export-story forest_adventure backup.json

# åŒ¯å‡ºæ‰€æœ‰æ•…äº‹
python seed_data.py --export-all all_stories.json

# åŒ¯å…¥æ•…äº‹
python seed_data.py --import-story new_story.json
```

**è³‡æ–™åº«ç¶­è­·**ï¼š

```bash
# æ¸…é™¤æ‰€æœ‰æ•…äº‹è³‡æ–™
python seed_data.py --clear-all

# é‡å»ºè³‡æ–™åº«çµæ§‹
python seed_data.py --rebuild-db
```

### ç›´æ¥è³‡æ–™åº«å­˜å–

å¦‚æœæ‚¨éœ€è¦ç›´æ¥å­˜å–è³‡æ–™åº«é€²è¡Œé™¤éŒ¯æˆ–ç¶­è­·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

**SQLite**ï¼š

```bash
# é–‹å•Ÿ SQLite å‘½ä»¤åˆ—
sqlite3 story_engine.db

# æŸ¥çœ‹æ‰€æœ‰è¡¨æ ¼
.tables

# æŸ¥çœ‹æ•…äº‹è¨»å†Šè¡¨
SELECT * FROM story_registry;

# æŸ¥çœ‹ç‰¹å®šæ•…äº‹çš„ç« ç¯€
SELECT * FROM story_forest_adventure;
```

**PostgreSQL**ï¼š

```bash
# é€£ç·šåˆ° PostgreSQL
psql -h localhost -U story_user -d story_engine

# æŸ¥çœ‹æ‰€æœ‰è¡¨æ ¼
\dt

# æŸ¥çœ‹æ•…äº‹è¨»å†Šè¡¨
SELECT * FROM story_registry;
```

---

## ğŸ§ª æ¸¬è©¦å’Œé™¤éŒ¯

### å–®å…ƒæ¸¬è©¦

æˆ‘å€‘æä¾›äº†å®Œæ•´çš„æ¸¬è©¦å¥—ä»¶ä¾†ç¢ºä¿ç³»çµ±åŠŸèƒ½æ­£å¸¸ã€‚æ¸¬è©¦åˆ†ç‚ºå¹¾å€‹ä¸»è¦é¡åˆ¥ï¼š

**API ç«¯é»æ¸¬è©¦**ï¼š

```bash
# åŸ·è¡Œå®Œæ•´çš„ API æ¸¬è©¦
python test_api.py

# æ¸¬è©¦ç‰¹å®šåŠŸèƒ½
python -c "
from test_api import test_story_list
test_story_list()
"
```

**è³‡æ–™åº«åŠŸèƒ½æ¸¬è©¦**ï¼š

```bash
# æ¸¬è©¦è³‡æ–™åº«é€£ç·š
python test_db_connection.py

# æ¸¬è©¦æ•…äº‹ç®¡ç†åŠŸèƒ½
python -c "
from seed_data import test_story_operations
test_story_operations()
"
```

**æ•…äº‹é©—è­‰æ¸¬è©¦**ï¼š

```bash
# é©—è­‰æ•…äº‹æ ¼å¼
python story_validator.py example_enhanced_story.json

# æ¸¬è©¦æ¢ä»¶å…§å®¹è§£æ
python -c "
from main import evaluate_condition
print(evaluate_condition('health > 50', {'health': 75}))
"
```

### é™¤éŒ¯æŠ€å·§

**å•Ÿç”¨è©³ç´°æ—¥èªŒ**ï¼š
åœ¨é–‹ç™¼éç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥å•Ÿç”¨è©³ç´°çš„æ—¥èªŒè¼¸å‡ºä¾†è¿½è¹¤å•é¡Œï¼š

```python
import logging

# åœ¨ main.py é–‹é ­åŠ å…¥
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

**ä½¿ç”¨ Python é™¤éŒ¯å™¨**ï¼š

```python
# åœ¨éœ€è¦é™¤éŒ¯çš„åœ°æ–¹åŠ å…¥
import pdb; pdb.set_trace()

# æˆ–ä½¿ç”¨æ›´ç¾ä»£çš„ breakpoint()
breakpoint()
```

**API è«‹æ±‚é™¤éŒ¯**ï¼š

```bash
# ä½¿ç”¨ curl æ¸¬è©¦ API
curl -X GET "http://localhost:8000/api/stories" -H "accept: application/json"

# æ¸¬è©¦æ•…äº‹ç« ç¯€è¼‰å…¥
curl -X POST "http://localhost:8000/api/story_engine/forest_adventure/1" \
  -H "Content-Type: application/json" \
  -d '{"game_state": {"health": 100}}'
```

**è³‡æ–™åº«æŸ¥è©¢é™¤éŒ¯**ï¼š

```python
# åœ¨ models.py ä¸­å•Ÿç”¨ SQL æŸ¥è©¢æ—¥èªŒ
engine = create_engine(
    DATABASE_URL,
    echo=True  # é€™æœƒå°å‡ºæ‰€æœ‰ SQL æŸ¥è©¢
)
```

### æ•ˆèƒ½åˆ†æ

**API å›æ‡‰æ™‚é–“æ¸¬è©¦**ï¼š

```bash
# ä½¿ç”¨ time å‘½ä»¤æ¸¬é‡å›æ‡‰æ™‚é–“
time curl -X GET "http://localhost:8000/api/stories"

# ä½¿ç”¨ Apache Bench é€²è¡Œå£“åŠ›æ¸¬è©¦
ab -n 100 -c 10 http://localhost:8000/api/stories
```

**è¨˜æ†¶é«”ä½¿ç”¨åˆ†æ**ï¼š

```python
# å®‰è£ memory_profiler
pip install memory_profiler

# åœ¨å‡½æ•¸å‰åŠ å…¥è£é£¾å™¨
@profile
def your_function():
    pass

# åŸ·è¡Œåˆ†æ
python -m memory_profiler your_script.py
```

---

## ğŸ¨ æ•…äº‹å…§å®¹é–‹ç™¼

### æ•…äº‹æ ¼å¼è¦ç¯„

æˆ‘å€‘çš„æ•…äº‹ç³»çµ±ä½¿ç”¨ JSON æ ¼å¼ä¾†å®šç¾©æ•…äº‹å…§å®¹ã€‚æ¯å€‹æ•…äº‹æª”æ¡ˆåŒ…å«å®Œæ•´çš„ç« ç¯€è³‡è¨Šã€é¸é …è¨­å®šå’ŒéŠæˆ²ç‹€æ…‹ç®¡ç†ã€‚

**åŸºæœ¬æ•…äº‹çµæ§‹**ï¼š

```json
{
  "story_info": {
    "story_id": "your_story_id",
    "title": "æ•…äº‹æ¨™é¡Œ",
    "description": "æ•…äº‹æè¿°",
    "author": "ä½œè€…åç¨±"
  },
  "chapters": [
    {
      "id": 1,
      "title": "ç« ç¯€æ¨™é¡Œ",
      "content": "ç« ç¯€å…§å®¹...",
      "options": [
        {
          "text": "é¸é …æ–‡å­—",
          "next_chapter": 2,
          "condition": "health > 50",
          "game_state": { "new_variable": true }
        }
      ]
    }
  ]
}
```

### æ¢ä»¶å…§å®¹ç³»çµ±

æˆ‘å€‘çš„æ¢ä»¶å…§å®¹ç³»çµ±æ”¯æ´è¤‡é›œçš„é‚è¼¯åˆ¤æ–·ï¼Œè®“æ•…äº‹èƒ½å¤ æ ¹æ“šç©å®¶ç‹€æ…‹å‹•æ…‹è®ŠåŒ–ã€‚

**å¸ƒæ—æ¢ä»¶**ï¼š

```
[[IF has_sword]]ä½ æ¡è‘—é‹’åˆ©çš„åŠï¼Œæº–å‚™è¿æ¥æŒ‘æˆ°ã€‚[[ENDIF]]
[[IF NOT has_key]]é–€æ˜¯é–è‘—çš„ï¼Œä½ éœ€è¦æ‰¾åˆ°é‘°åŒ™ã€‚[[ENDIF]]
```

**æ•¸å€¼æ¯”è¼ƒæ¢ä»¶**ï¼š

```
[[IF health > 80]]ä½ æ„Ÿè¦ºç²¾åŠ›å……æ²›ã€‚[[ENDIF]]
[[IF strength >= 18]]ä½ çš„åŠ›é‡è¶³ä»¥æ¨é–‹é€™æ‰‡é–€ã€‚[[ENDIF]]
[[IF gold < 10]]ä½ çš„éŒ¢åŒ…å¹¾ä¹ç©ºäº†ã€‚[[ENDIF]]
```

**è¤‡åˆæ¢ä»¶**ï¼š

```
[[IF has_sword AND strength > 15]]æ†‘è—‰ä½ çš„åŠè¡“å’ŒåŠ›é‡ï¼Œä½ æœ‰ä¿¡å¿ƒé¢å°ä»»ä½•æ•µäººã€‚[[ENDIF]]
[[IF health <= 30 OR poisoned]]ä½ æ„Ÿåˆ°èº«é«”è™›å¼±ï¼Œéœ€è¦ä¼‘æ¯æˆ–æ²»ç™‚ã€‚[[ENDIF]]
```

### æ•…äº‹é–‹ç™¼å·¥å…·

**æ•…äº‹é©—è­‰å™¨**ï¼š

```bash
# é©—è­‰æ•…äº‹æ ¼å¼å’Œé‚è¼¯
python story_validator.py your_story.json
```

é©—è­‰å™¨æœƒæª¢æŸ¥ä»¥ä¸‹é …ç›®ï¼š

- JSON æ ¼å¼æ­£ç¢ºæ€§
- å¿…è¦æ¬„ä½å®Œæ•´æ€§
- ç« ç¯€å¼•ç”¨ä¸€è‡´æ€§
- æ¢ä»¶èªæ³•æ­£ç¢ºæ€§
- éŠæˆ²ç‹€æ…‹é‚è¼¯åˆç†æ€§

**æ•…äº‹è½‰æ›å™¨**ï¼š

```bash
# è½‰æ›ç‚º Markdown æ–‡ä»¶
python story_converter.py your_story.json --markdown story.md

# ç”Ÿæˆæµç¨‹åœ–
python story_converter.py your_story.json --flowchart story.mmd

# åŒ¯å‡ºç‚º CSV è¡¨æ ¼
python story_converter.py your_story.json --csv story.csv

# é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š
python story_converter.py your_story.json --stats
```

**æ•…äº‹ç·¨è¼¯è¼”åŠ©**ï¼š

```bash
# å»ºç«‹æ–°æ•…äº‹ç¯„æœ¬
python seed_data.py --create-template new_story.json

# è¤‡è£½ç¾æœ‰æ•…äº‹ä½œç‚ºç¯„æœ¬
python seed_data.py --copy-story forest_adventure new_adventure.json
```

### éŠæˆ²å¹³è¡¡è¨­è¨ˆ

åœ¨è¨­è¨ˆæ•…äº‹æ™‚ï¼Œéœ€è¦è€ƒæ…®éŠæˆ²å¹³è¡¡æ€§ï¼Œç¢ºä¿ç©å®¶æœ‰åˆç†çš„æŒ‘æˆ°å’Œæˆå°±æ„Ÿã€‚

**å±¬æ€§è¨­è¨ˆåŸå‰‡**ï¼š

- ç”Ÿå‘½å€¼é€šå¸¸è¨­å®šåœ¨ 50-150 ä¹‹é–“
- å±¬æ€§å€¼ï¼ˆåŠ›é‡ã€æ™ºæ…§ç­‰ï¼‰é€šå¸¸è¨­å®šåœ¨ 1-30 ä¹‹é–“
- é‡‘éŒ¢å’Œç¶“é©—å€¼å¯ä»¥æœ‰æ›´å¤§çš„ç¯„åœ

**é›£åº¦æ›²ç·šè¨­è¨ˆ**ï¼š

- åˆæœŸç« ç¯€æ‡‰è©²ç›¸å°ç°¡å–®ï¼Œè®“ç©å®¶ç†Ÿæ‚‰éŠæˆ²æ©Ÿåˆ¶
- ä¸­æœŸé€æ¼¸å¢åŠ æŒ‘æˆ°æ€§ï¼Œå¼•å…¥æ›´è¤‡é›œçš„é¸æ“‡
- å¾ŒæœŸæä¾›é«˜é›£åº¦æŒ‘æˆ°ï¼Œä½†ä¹Ÿè¦æœ‰å¤šç¨®è§£æ±ºæ–¹æ¡ˆ

**åˆ†æ”¯è¨­è¨ˆ**ï¼š

- ç¢ºä¿æ¯å€‹é¸æ“‡éƒ½æœ‰æ„ç¾©å’Œå¾Œæœ
- é¿å…ã€Œå‡é¸æ“‡ã€ï¼ˆçœ‹ä¼¼ä¸åŒä½†çµæœç›¸åŒçš„é¸æ“‡ï¼‰
- æä¾›å¤šæ¢è·¯å¾‘é”åˆ°ç›¸åŒç›®æ¨™

---

## ğŸ”§ è‡ªè¨‚å’Œæ“´å±•

### æ–°å¢è‡ªè¨‚ API ç«¯é»

å¦‚æœæ‚¨éœ€è¦æ–°å¢è‡ªè¨‚åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ `main.py` ä¸­æ–°å¢æ–°çš„ API ç«¯é»ï¼š

```python
@app.get("/api/custom/player_stats/{story_id}")
async def get_player_stats(story_id: str, db: Session = Depends(get_db)):
    """å–å¾—ç©å®¶çµ±è¨ˆè³‡è¨Š"""
    # å¯¦ä½œæ‚¨çš„é‚è¼¯
    return {"story_id": story_id, "stats": {}}

@app.post("/api/custom/save_progress")
async def save_progress(request: SaveProgressRequest, db: Session = Depends(get_db)):
    """å„²å­˜éŠæˆ²é€²åº¦"""
    # å¯¦ä½œé€²åº¦å„²å­˜é‚è¼¯
    return {"success": True}
```

è¨˜å¾—åŒæ™‚æ›´æ–° `schemas.py` ä¸­çš„è³‡æ–™æ¨¡å‹ï¼š

```python
class SaveProgressRequest(BaseModel):
    story_id: str
    chapter_id: int
    game_state: Dict[str, Any]
    player_name: Optional[str] = None
```

### æ–°å¢è‡ªè¨‚æ¢ä»¶å‡½æ•¸

æ‚¨å¯ä»¥æ“´å±•æ¢ä»¶å…§å®¹ç³»çµ±ï¼Œæ–°å¢è‡ªè¨‚çš„æ¢ä»¶å‡½æ•¸ï¼š

```python
def evaluate_custom_condition(condition: str, game_state: dict) -> bool:
    """è©•ä¼°è‡ªè¨‚æ¢ä»¶"""
    if condition.startswith("CUSTOM:"):
        custom_condition = condition[7:]  # ç§»é™¤ "CUSTOM:" å‰ç¶´

        if custom_condition == "is_weekend":
            from datetime import datetime
            return datetime.now().weekday() >= 5

        elif custom_condition.startswith("random_chance:"):
            import random
            chance = int(custom_condition.split(":")[1])
            return random.randint(1, 100) <= chance

    return False
```

### æ–°å¢æ•…äº‹æ ¼å¼æ”¯æ´

å¦‚æœæ‚¨æƒ³è¦æ”¯æ´å…¶ä»–æ•…äº‹æ ¼å¼ï¼Œå¯ä»¥å»ºç«‹æ–°çš„è½‰æ›å™¨ï¼š

```python
class TwineConverter:
    """Twine æ ¼å¼è½‰æ›å™¨"""

    def import_from_twine(self, twine_file: str) -> dict:
        """å¾ Twine æ ¼å¼åŒ¯å…¥æ•…äº‹"""
        # å¯¦ä½œ Twine æ ¼å¼è§£æé‚è¼¯
        pass

    def export_to_twine(self, story_data: dict) -> str:
        """åŒ¯å‡ºç‚º Twine æ ¼å¼"""
        # å¯¦ä½œ Twine æ ¼å¼ç”Ÿæˆé‚è¼¯
        pass
```

### æ•´åˆå¤–éƒ¨æœå‹™

æ‚¨å¯ä»¥æ•´åˆå¤–éƒ¨æœå‹™ä¾†å¢å¼·æ•…äº‹é«”é©—ï¼š

**AI æ–‡å­—ç”Ÿæˆ**ï¼š

```python
import openai

async def generate_dynamic_content(prompt: str) -> str:
    """ä½¿ç”¨ AI ç”Ÿæˆå‹•æ…‹å…§å®¹"""
    response = await openai.ChatCompletion.acreate(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": prompt}]
    )
    return response.choices[0].message.content
```

**åœ–ç‰‡ç”Ÿæˆ**ï¼š

```python
async def generate_scene_image(description: str) -> str:
    """ç”Ÿæˆå ´æ™¯åœ–ç‰‡"""
    # æ•´åˆ DALL-E æˆ–å…¶ä»–åœ–ç‰‡ç”Ÿæˆæœå‹™
    pass
```

---

## ğŸš¨ å¸¸è¦‹å•é¡Œè§£æ±º

### å®‰è£ç›¸é—œå•é¡Œ

**å•é¡Œï¼špip å®‰è£ psycopg2-binary å¤±æ•—**

é€™æ˜¯æœ€å¸¸è¦‹çš„å•é¡Œä¹‹ä¸€ï¼Œé€šå¸¸ç™¼ç”Ÿåœ¨ Windows ç³»çµ±ä¸Šã€‚è§£æ±ºæ–¹æ³•ï¼š

```bash
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨é ç·¨è­¯ç‰ˆæœ¬
pip install --only-binary=:all: psycopg2-binary

# æ–¹æ³•äºŒï¼šå¦‚æœä»ç„¶å¤±æ•—ï¼Œæ”¹ç”¨ SQLite
echo "DATABASE_URL=sqlite:///./story_engine.db" > .env

# æ–¹æ³•ä¸‰ï¼šåœ¨ Windows ä¸Šå®‰è£ Visual C++ Build Tools
# ä¸‹è¼‰ä¸¦å®‰è£ Microsoft C++ Build Tools
```

**å•é¡Œï¼šPydantic ç‰ˆæœ¬ç›¸å®¹æ€§å•é¡Œ**

å¦‚æœé‡åˆ° Pydantic ç›¸é—œéŒ¯èª¤ï¼Œå¯èƒ½æ˜¯ç‰ˆæœ¬ç›¸å®¹æ€§å•é¡Œï¼š

```bash
# é™ç´šåˆ°ç›¸å®¹ç‰ˆæœ¬
pip install pydantic==1.10.13

# æˆ–å‡ç´šåˆ°æœ€æ–°ç‰ˆæœ¬
pip install --upgrade pydantic
```

**å•é¡Œï¼šè™›æ“¬ç’°å¢ƒå•Ÿå‹•å¤±æ•—**

åœ¨æŸäº›ç³»çµ±ä¸Šï¼Œè™›æ“¬ç’°å¢ƒå¯èƒ½ç„¡æ³•æ­£å¸¸å•Ÿå‹•ï¼š

```bash
# Windows PowerShell åŸ·è¡Œæ”¿ç­–å•é¡Œ
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# æˆ–ä½¿ç”¨ conda å»ºç«‹ç’°å¢ƒ
conda create -n story-engine python=3.11
conda activate story-engine
```

### è³‡æ–™åº«ç›¸é—œå•é¡Œ

**å•é¡Œï¼šè³‡æ–™åº«é€£ç·šå¤±æ•—**

æª¢æŸ¥ä»¥ä¸‹é …ç›®ï¼š

1. ç¢ºèª `.env` æª”æ¡ˆä¸­çš„ DATABASE_URL è¨­å®šæ­£ç¢º
2. å¦‚æœä½¿ç”¨ PostgreSQLï¼Œç¢ºèªæœå‹™æ­£åœ¨é‹è¡Œ
3. æª¢æŸ¥è³‡æ–™åº«ä½¿ç”¨è€…æ¬Šé™
4. ç¢ºèªé˜²ç«ç‰†è¨­å®š

```bash
# æ¸¬è©¦è³‡æ–™åº«é€£ç·š
python test_db_connection.py

# æª¢æŸ¥ PostgreSQL æœå‹™ç‹€æ…‹
sudo systemctl status postgresql

# é‡æ–°å•Ÿå‹• PostgreSQL
sudo systemctl restart postgresql
```

**å•é¡Œï¼šè³‡æ–™è¡¨ä¸å­˜åœ¨**

å¦‚æœé‡åˆ°è³‡æ–™è¡¨ä¸å­˜åœ¨çš„éŒ¯èª¤ï¼š

```bash
# é‡æ–°å»ºç«‹è³‡æ–™åº«çµæ§‹
python -c "from models import create_tables; create_tables()"

# æˆ–é‡æ–°åŸ·è¡Œåˆå§‹åŒ–
python seed_data.py --rebuild-db
```

**å•é¡Œï¼šè³‡æ–™åº«é–å®šï¼ˆSQLiteï¼‰**

SQLite è³‡æ–™åº«æœ‰æ™‚æœƒå‡ºç¾é–å®šå•é¡Œï¼š

```bash
# é—œé–‰æ‰€æœ‰ä½¿ç”¨è³‡æ–™åº«çš„ç¨‹åº
pkill -f uvicorn

# åˆªé™¤é–å®šæª”æ¡ˆï¼ˆå¦‚æœå­˜åœ¨ï¼‰
rm -f story_engine.db-wal story_engine.db-shm

# é‡æ–°å•Ÿå‹•æœå‹™
uvicorn main:app --reload
```

### API ç›¸é—œå•é¡Œ

**å•é¡Œï¼šAPI å›æ‡‰ 500 éŒ¯èª¤**

æª¢æŸ¥æœå‹™å™¨æ—¥èªŒä¾†è¨ºæ–·å•é¡Œï¼š

```bash
# å•Ÿç”¨è©³ç´°æ—¥èªŒ
uvicorn main:app --reload --log-level debug

# æª¢æŸ¥ç‰¹å®šéŒ¯èª¤
python -c "
import traceback
try:
    from main import app
    print('App loaded successfully')
except Exception as e:
    traceback.print_exc()
"
```

**å•é¡Œï¼šCORS éŒ¯èª¤**

å¦‚æœåœ¨ç€è¦½å™¨ä¸­é‡åˆ° CORS éŒ¯èª¤ï¼š

```python
# åœ¨ main.py ä¸­ç¢ºèª CORS è¨­å®š
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # é–‹ç™¼ç’°å¢ƒå¯ä»¥ä½¿ç”¨ *
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**å•é¡Œï¼šJSON åºåˆ—åŒ–éŒ¯èª¤**

å¦‚æœé‡åˆ° JSON åºåˆ—åŒ–å•é¡Œï¼š

```python
# æª¢æŸ¥è³‡æ–™é¡å‹
import json

try:
    json.dumps(your_data)
except TypeError as e:
    print(f"JSON serialization error: {e}")
    # æª¢æŸ¥æ˜¯å¦æœ‰ä¸å¯åºåˆ—åŒ–çš„ç‰©ä»¶
```

### æ•ˆèƒ½ç›¸é—œå•é¡Œ

**å•é¡Œï¼šAPI å›æ‡‰ç·©æ…¢**

å„ªåŒ–å»ºè­°ï¼š

```python
# æ–°å¢è³‡æ–™åº«ç´¢å¼•
from sqlalchemy import Index

# åœ¨æ¨¡å‹ä¸­æ–°å¢ç´¢å¼•
class Chapter(Base):
    __tablename__ = "story_chapters"

    id = Column(Integer, primary_key=True)
    story_id = Column(String, index=True)  # æ–°å¢ç´¢å¼•

    __table_args__ = (
        Index('idx_story_chapter', 'story_id', 'id'),
    )
```

```bash
# ä½¿ç”¨é€£ç·šæ± 
pip install sqlalchemy[pool]
```

**å•é¡Œï¼šè¨˜æ†¶é«”ä½¿ç”¨éé«˜**

ç›£æ§å’Œå„ªåŒ–è¨˜æ†¶é«”ä½¿ç”¨ï¼š

```python
# å®‰è£è¨˜æ†¶é«”ç›£æ§å·¥å…·
pip install psutil

# åœ¨ç¨‹å¼ç¢¼ä¸­ç›£æ§è¨˜æ†¶é«”
import psutil
import os

def get_memory_usage():
    process = psutil.Process(os.getpid())
    return process.memory_info().rss / 1024 / 1024  # MB
```

---

## ğŸ“ˆ æ•ˆèƒ½å„ªåŒ–

### è³‡æ–™åº«å„ªåŒ–

**æŸ¥è©¢å„ªåŒ–**ï¼š

```python
# ä½¿ç”¨ select_related æ¸›å°‘æŸ¥è©¢æ¬¡æ•¸
from sqlalchemy.orm import selectinload

def get_story_with_chapters(db: Session, story_id: str):
    return db.query(Story).options(
        selectinload(Story.chapters)
    ).filter(Story.story_id == story_id).first()
```

**é€£ç·šæ± è¨­å®š**ï¼š

```python
from sqlalchemy import create_engine
from sqlalchemy.pool import QueuePool

engine = create_engine(
    DATABASE_URL,
    poolclass=QueuePool,
    pool_size=10,
    max_overflow=20,
    pool_pre_ping=True,
    pool_recycle=3600
)
```

**ç´¢å¼•ç­–ç•¥**ï¼š

```sql
-- ç‚ºç¶“å¸¸æŸ¥è©¢çš„æ¬„ä½æ–°å¢ç´¢å¼•
CREATE INDEX idx_story_registry_story_id ON story_registry(story_id);
CREATE INDEX idx_chapter_story_id ON story_forest_adventure(id);
```

### æ‡‰ç”¨ç¨‹å¼å„ªåŒ–

**å¿«å–æ©Ÿåˆ¶**ï¼š

```python
from functools import lru_cache
import time

@lru_cache(maxsize=128)
def get_cached_story_info(story_id: str):
    """å¿«å–æ•…äº‹è³‡è¨Š"""
    # å¯¦ä½œå¿«å–é‚è¼¯
    pass

# ä½¿ç”¨ Redis é€²è¡Œåˆ†æ•£å¼å¿«å–
import redis

redis_client = redis.Redis(host='localhost', port=6379, db=0)

def cache_story_chapter(story_id: str, chapter_id: int, content: dict):
    key = f"story:{story_id}:chapter:{chapter_id}"
    redis_client.setex(key, 3600, json.dumps(content))  # å¿«å– 1 å°æ™‚
```

**ç•°æ­¥è™•ç†**ï¼š

```python
import asyncio
from concurrent.futures import ThreadPoolExecutor

async def process_story_async(story_data: dict):
    """ç•°æ­¥è™•ç†æ•…äº‹è³‡æ–™"""
    loop = asyncio.get_event_loop()
    with ThreadPoolExecutor() as executor:
        result = await loop.run_in_executor(
            executor,
            process_story_sync,
            story_data
        )
    return result
```

### å‰ç«¯å„ªåŒ–

**API å›æ‡‰å£“ç¸®**ï¼š

```python
from fastapi.middleware.gzip import GZipMiddleware

app.add_middleware(GZipMiddleware, minimum_size=1000)
```

**å›æ‡‰å¿«å–**ï¼š

```python
from fastapi import Header
from datetime import datetime, timedelta

@app.get("/api/stories")
async def get_stories(
    if_modified_since: str = Header(None)
):
    # å¯¦ä½œæ¢ä»¶å¼è«‹æ±‚
    last_modified = get_stories_last_modified()

    if if_modified_since:
        if_modified_since_dt = datetime.fromisoformat(if_modified_since)
        if last_modified <= if_modified_since_dt:
            return Response(status_code=304)  # Not Modified

    stories = get_all_stories()
    response = JSONResponse(stories)
    response.headers["Last-Modified"] = last_modified.isoformat()
    response.headers["Cache-Control"] = "max-age=3600"
    return response
```

---

## ğŸ“š åƒè€ƒè³‡æº

### å®˜æ–¹æ–‡ä»¶

- [FastAPI å®˜æ–¹æ–‡ä»¶](https://fastapi.tiangolo.com/) - FastAPI æ¡†æ¶çš„å®Œæ•´æ–‡ä»¶
- [SQLAlchemy å®˜æ–¹æ–‡ä»¶](https://docs.sqlalchemy.org/) - SQLAlchemy ORM çš„è©³ç´°èªªæ˜
- [Pydantic å®˜æ–¹æ–‡ä»¶](https://pydantic-docs.helpmanual.io/) - Pydantic è³‡æ–™é©—è­‰åº«æ–‡ä»¶
- [PostgreSQL å®˜æ–¹æ–‡ä»¶](https://www.postgresql.org/docs/) - PostgreSQL è³‡æ–™åº«æ–‡ä»¶

### é–‹ç™¼å·¥å…·

- [Visual Studio Code](https://code.visualstudio.com/) - æ¨è–¦çš„ç¨‹å¼ç¢¼ç·¨è¼¯å™¨
- [PyCharm](https://www.jetbrains.com/pycharm/) - å°ˆæ¥­çš„ Python IDE
- [Postman](https://www.postman.com/) - API æ¸¬è©¦å·¥å…·
- [DBeaver](https://dbeaver.io/) - é€šç”¨è³‡æ–™åº«ç®¡ç†å·¥å…·

### Python å¥—ä»¶

- [uvicorn](https://www.uvicorn.org/) - ASGI æœå‹™å™¨
- [pytest](https://pytest.org/) - Python æ¸¬è©¦æ¡†æ¶
- [black](https://black.readthedocs.io/) - Python ç¨‹å¼ç¢¼æ ¼å¼åŒ–å·¥å…·
- [flake8](https://flake8.pycqa.org/) - Python ç¨‹å¼ç¢¼æª¢æŸ¥å·¥å…·

### ç¤¾ç¾¤è³‡æº

- [FastAPI GitHub](https://github.com/tiangolo/fastapi) - FastAPI åŸå§‹ç¢¼å’Œå•é¡Œè¿½è¹¤
- [Python.org](https://www.python.org/) - Python å®˜æ–¹ç¶²ç«™
- [Stack Overflow](https://stackoverflow.com/questions/tagged/fastapi) - FastAPI ç›¸é—œå•é¡Œè¨è«–
- [Reddit r/Python](https://www.reddit.com/r/Python/) - Python ç¤¾ç¾¤è¨è«–

---
